(()=>{"use strict";const e=function(){function e(e,t,n,r){this.providedAnswer="",this.id=e,this.text=t,this.options=n,this.correctAnswer=r}return e.prototype.answer=function(e){if(this.isAnswered())throw new Error("Can not answer twice on the same question");return this.providedAnswer=e,e===this.correctAnswer},e.prototype.recallAnswer=function(){this.providedAnswer=""},e.prototype.isAnswered=function(){return""!==this.providedAnswer},e.prototype.render=function(e){if(this.isAnswered())return this.renderSummary();var t=document.createElement("div"),n="";n+='<p class="test-question">'+this.id+". "+this.text+"</p>";for(var r=0,i=this.options;r<i.length;r++){var s=i[r];n+='<div class="answer-option">   <input type="radio" name="answer" value="'+s+'"/>   <label for="answer">'+s+"</label></div>"}return t.innerHTML=n,t.querySelectorAll('input[type="radio"]').forEach((function(t){var n=t;n.addEventListener("click",(function(){return e(n.value)}))})),t},e.prototype.renderSummary=function(){var e=document.createElement("div"),t="";return t+="<p>"+this.id+". "+this.text+"</p>",this.providedAnswer===this.correctAnswer?t+="<p>✅ "+this.providedAnswer+"</p>":t+="<p>⚠️ "+this.providedAnswer+" (правильно: "+this.correctAnswer+")</p>",e.innerHTML=t,e},e}();const t=function(){function e(e){this.questions=e,this.currentQuestionNumber=0,this.result=[]}return e.prototype.getCurrentQuestion=function(){var e;return null!==(e=this.questions[this.currentQuestionNumber])&&void 0!==e?e:null},e.prototype.answer=function(e){var t=this.getCurrentQuestion();null!==t?(t.answer(e),t.isAnswered()&&(this.result[this.currentQuestionNumber]=t,this.currentQuestionNumber+=1)):console.error("Runtime error: there are no questions left")},e.prototype.getResult=function(){return this.result},e.prototype.reset=function(){this.result=[],this.currentQuestionNumber=0;for(var e=0,t=this.questions;e<t.length;e++){t[e].recallAnswer()}},e}();var n=function(){function e(e){this.testUI=document.getElementById("test"),this.test=e,document.getElementById("content").style.display="none"}return e.prototype.render=function(){var e=this;this.testUI.style.display="block";var t,n=this.test.getCurrentQuestion();t=null!==n?n.render((function(t){e.test.answer(t),e.render()})):this.renderResult(),this.testUI.replaceChildren(t)},e.prototype.renderResult=function(){for(var e=this,t=document.createElement("div"),n=0,r=this.test.getResult();n<r.length;n++){var i=r[n];t.appendChild(i.render((function(){})))}var s=document.createElement("button");return s.innerText="Начать тест заново",s.addEventListener("click",(function(){e.test.reset(),e.render()})),t.appendChild(s),t},e}();const r=n;const i=function(){function e(){var e=document.getElementById("tooltip");null===e&&((e=document.createElement("span")).className="tooltip",e.id="tooltip",e.style.visibility="hidden",document.body.appendChild(e)),this.element=e}return e.prototype.show=function(e,t){if("visible"!==this.element.style.visibility){var n=this.getElementOffset(t);this.element.style.visibility="visible",this.element.innerText=e,this.element.style.left=n.left+"px",this.element.style.top=n.top-20+"px"}},e.prototype.hide=function(){this.element.style.visibility="hidden",this.element.innerText=""},e.prototype.getElementOffset=function(e){var t=e.getBoundingClientRect();return{left:t.left+window.scrollX,top:t.top+window.scrollY}},e}();const s=function(){function e(e,t,n){this.id=e,this.text=t,this.answers=n,this.providedAnswers=[]}return e.prototype.answer=function(e){this.providedAnswers[e.part]=e.text},e.prototype.recallAnswer=function(){this.providedAnswers=[]},e.prototype.render=function(e){var t=this;if(this.isAnswered())return this.renderSummary();var n=document.createElement("div");return n.appendChild(document.createTextNode(this.id+". ")),this.text.split(/({\d})/).forEach((function(r){if(/^{\d}$/.test(r)){var i=r.match(/\d/).shift(),s="______";t.providedAnswers.hasOwnProperty(i)&&(s=t.providedAnswers[i]);var o=document.createElement("span");o.id=t.getOptionId(i),o.innerHTML='<span style="color:gray;">'+s+"</span>",o.addEventListener("click",(function(){if(!t.isAnswered()){var r=document.createElement("div");r.className="options show",Object.values(t.answers).forEach((function(t){var s=document.createElement("div");s.className="option",s.textContent=t,s.addEventListener("click",(function(){n.removeChild(r),e({part:i,text:t})})),r.appendChild(s)})),n.appendChild(r)}})),n.appendChild(o)}else n.appendChild(document.createTextNode(r))})),n},e.prototype.isAnswered=function(){return Object.keys(this.providedAnswers).length===Object.keys(this.answers).length},e.prototype.getOptionId=function(e){return"answer-"+e},e.prototype.renderSummary=function(){var e=this;if(!this.isAnswered())throw new Error("Can not show summary for unanswered question");var t=new i,n=document.createElement("div");return n.appendChild(document.createTextNode(this.id+". ")),this.text.split(/({\d})/).forEach((function(r){if(/^{\d}$/.test(r)){var i=r.match(/\d/).shift(),s=e.providedAnswers[i],o=e.answers[i],d=document.createElement("span");d.innerText=s,d.style.color="green",s!==o&&(d.style.color="yellow",d.addEventListener("mouseover",(function(e){var n=e.target;t.show("Правильно: "+o,n)})),d.addEventListener("mouseout",(function(){return t.hide()}))),n.appendChild(d)}else n.appendChild(document.createTextNode(r))})),n},e}();const o=function(){function n(){}return n.createTranslationTest=function(n){var i=function(){return.5-Math.random()},s=function(e,t){var r=Object.values(n).sort(i);if(r.length-1<t)throw new Error("Requested more translations than we can provide");for(var s=[e];s.length<t+1;){var o=r.shift();o!==e&&s.push(o)}return s.sort(i)},o=[],d=1;for(var u in n)o.push(new e((d++).toString(),'Как сказать "'+u+'"?',s(n[u],3),n[u]));return new r(new t(o))},n.createChoiceTest=function(n){for(var i=[],s=1,o=0,d=n;o<d.length;o++){var u=d[o];i.push(new e((s++).toString(),u.text,u.choices,u.answer))}return new r(new t(i))},n.createMultiChoiceTest=function(e){for(var n=[],i=1,o=0,d=e;o<d.length;o++){var u=d[o];n.push(new s((i++).toString(),u.text,u.choices))}return new r(new t(n))},n}();document.addEventListener("DOMContentLoaded",(function(){for(var e=document.querySelectorAll("[data-description]"),t=new i,n=0;n<e.length;n++)e[n].addEventListener("mouseover",(function(e){var n=e.target;t.show(n.dataset.description,n)})),e[n].addEventListener("mouseout",(function(){return t.hide()}))}));var d=window;d.registerTranslationTest=function(e){document.addEventListener("DOMContentLoaded",(function(){document.getElementById("start-test").addEventListener("click",(function(){o.createTranslationTest(e).render()}))}))},d.registerChoiceTest=function(e){document.addEventListener("DOMContentLoaded",(function(){document.getElementById("start-test").addEventListener("click",(function(){o.createChoiceTest(e).render()}))}))},d.registerMultiChoiceTest=function(e){document.addEventListener("DOMContentLoaded",(function(){document.getElementById("start-test").addEventListener("click",(function(){o.createMultiChoiceTest(e).render()}))}))}})();